import{s as $e,T as De,B as Ae,e as re,a as be,l as Ze,c as ae,b as se,f as B,g as he,o as K,C as qe,i as fe,h as H,p as mt,U as Be,V as We,W as xe,L as He,k as Fe,N as yt,t as je,d as Me,j as Ne,n as Ge,M as bt,P as S,R as et,Q as ht}from"./scheduler.60fdcb34.js";import{S as tt,i as nt,t as ge,b as we}from"./index.c7b4b125.js";import{g as pt}from"./spread.8a54911c.js";import"./paths.9f848c40.js";import{F as vt}from"./form.be75c675.js";import{c as Je,b as Ye}from"./index.b20a7130.js";import{i as _t,b as gt}from"./navigation.82bf316a.js";import{p as le}from"./stores.b0332cd2.js";import{d as Q,w as q}from"./singletons.f8a34b6d.js";import{U as rt,N as wt,P as St,a as kt,b as at,H as Et,p as Pt}from"./parse.7d180a0f.js";import{e as At,a as Se}from"./forms.eea97056.js";import{B as Ft,D as jt}from"./prod-browser.020bfb54.js";import"./index.f836e1a8.js";class ke extends Error{constructor(e,r){super(e),this.name="DevalueError",this.path=r.join("")}}function Ke(t){return Object(t)!==t}const Mt=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Nt(t){const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null||Object.getOwnPropertyNames(e).sort().join("\0")===Mt}function Ot(t){return Object.prototype.toString.call(t).slice(8,-1)}function Ct(t){switch(t){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t<" "?`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function ne(t){let e="",r=0;const a=t.length;for(let o=0;o<a;o+=1){const i=t[o],n=Ct(i);n&&(e+=t.slice(r,o)+n,r=o+1)}return`"${r===0?t:e+t.slice(r)}"`}function st(t,e){const r=[],a=new Map,o=[];for(const l in e)o.push({key:l,fn:e[l]});const i=[];let n=0;function f(l){if(typeof l=="function")throw new ke("Cannot stringify a function",i);if(a.has(l))return a.get(l);if(l===void 0)return rt;if(Number.isNaN(l))return wt;if(l===1/0)return St;if(l===-1/0)return kt;if(l===0&&1/l<0)return at;const m=n++;a.set(l,m);for(const{key:d,fn:h}of o){const _=h(l);if(_)return r[m]=`["${d}",${f(_)}]`,m}let c="";if(Ke(l))c=Ee(l);else switch(Ot(l)){case"Number":case"String":case"Boolean":c=`["Object",${Ee(l)}]`;break;case"BigInt":c=`["BigInt",${l}]`;break;case"Date":c=`["Date","${l.toISOString()}"]`;break;case"RegExp":const{source:h,flags:_}=l;c=_?`["RegExp",${ne(h)},"${_}"]`:`["RegExp",${ne(h)}]`;break;case"Array":c="[";for(let y=0;y<l.length;y+=1)y>0&&(c+=","),y in l?(i.push(`[${y}]`),c+=f(l[y]),i.pop()):c+=Et;c+="]";break;case"Set":c='["Set"';for(const y of l)c+=`,${f(y)}`;c+="]";break;case"Map":c='["Map"';for(const[y,N]of l)i.push(`.get(${Ke(y)?Ee(y):"..."})`),c+=`,${f(y)},${f(N)}`;c+="]";break;default:if(!Nt(l))throw new ke("Cannot stringify arbitrary non-POJOs",i);if(Object.getOwnPropertySymbols(l).length>0)throw new ke("Cannot stringify POJOs with symbolic keys",i);if(Object.getPrototypeOf(l)===null){c='["null"';for(const y in l)i.push(`.${y}`),c+=`,${ne(y)},${f(l[y])}`,i.pop();c+="]"}else{c="{";let y=!1;for(const N in l)y&&(c+=","),y=!0,i.push(`.${N}`),c+=`${ne(N)}:${f(l[N])}`,i.pop();c+="}"}}return r[m]=c,m}const u=f(t);return u<0?`${u}`:`[${r.join(",")}]`}function Ee(t){const e=typeof t;return e==="string"?ne(t):t instanceof String?ne(t.toString()):t===void 0?rt.toString():t===0&&1/t<0?at.toString():e==="bigint"?`["BigInt","${t}"]`:String(t)}const it=Ft,It=jt,Vt=t=>({}),Qe=t=>({});function Xe(t){let e;return{c(){e=je(t[3])},l(r){e=Me(r,t[3])},m(r,a){fe(r,e,a)},p(r,a){a&8&&Ne(e,r[3])},d(r){r&&B(e)}}}function Lt(t){let e,r,a,o,i,n,f,u,l,m,c=t[3]&&Xe(t);const d=t[10].default,h=De(d,t,t[9],null),_=t[10].bottomLinks,y=De(_,t,t[9],Qe);let N=[{method:"post"},{action:t[2]},t[8]],k={};for(let p=0;p<N.length;p+=1)k=Ae(k,N[p]);let J=It;return{c(){e=re("form"),r=re("div"),a=re("div"),c&&c.c(),o=be(),h&&h.c(),i=be(),y&&y.c(),n=be(),f=Ze(),this.h()},l(p){e=ae(p,"FORM",{method:!0,action:!0});var E=se(e);r=ae(E,"DIV",{class:!0});var G=se(r);a=ae(G,"DIV",{class:!0});var T=se(a);c&&c.l(T),T.forEach(B),G.forEach(B),o=he(E),h&&h.l(E),i=he(E),y&&y.l(E),E.forEach(B),n=he(p),f=Ze(),this.h()},h(){K(a,"class","min-h-7"),K(r,"class","flex justify-end text-warning min-h-7"),qe(e,k)},m(p,E){fe(p,e,E),H(e,r),H(r,a),c&&c.m(a,null),H(e,o),h&&h.m(e,null),H(e,i),y&&y.m(e,null),fe(p,n,E),fe(p,f,E),u=!0,l||(m=mt(t[7].call(null,e)),l=!0)},p(p,[E]){p[3]?c?c.p(p,E):(c=Xe(p),c.c(),c.m(a,null)):c&&(c.d(1),c=null),h&&h.p&&(!u||E&512)&&Be(h,d,p,p[9],u?xe(d,p[9],E,null):We(p[9]),null),y&&y.p&&(!u||E&512)&&Be(y,_,p,p[9],u?xe(_,p[9],E,Vt):We(p[9]),Qe),qe(e,k=pt(N,[{method:"post"},(!u||E&4)&&{action:p[2]},E&256&&p[8]]))},i(p){u||(ge(h,p),ge(y,p),ge(J),u=!0)},o(p){we(h,p),we(y,p),we(J),u=!1},d(p){p&&(B(e),B(n),B(f)),c&&c.d(),h&&h.d(p),y&&y.d(p),l=!1,m()}}}function Rt(t,e,r){const a=["formObj","noDebug","action"];let o=He(e,a),i,n,{$$slots:f={},$$scope:u}=e,{formObj:l}=e,{noDebug:m=!1}=e,{action:c=void 0}=e;const{form:d,message:h,enhance:_}=l;return Fe(t,d,y=>r(4,n=y)),Fe(t,h,y=>r(3,i=y)),t.$$set=y=>{e=Ae(Ae({},e),yt(y)),r(8,o=He(e,a)),"formObj"in y&&r(0,l=y.formObj),"noDebug"in y&&r(1,m=y.noDebug),"action"in y&&r(2,c=y.action),"$$scope"in y&&r(9,u=y.$$scope)},[l,m,c,i,n,d,h,_,o,u,f]}class mn extends tt{constructor(e){super(),nt(this,e,Rt,Lt,$e,{formObj:0,noDebug:1,action:2})}}function Ut(t){let e,r,a=(t[1]?t[1]:Je(t[0]))+"",o,i,n,f=t[3]?"*":"",u,l;return{c(){e=re("label"),r=re("span"),o=je(a),i=be(),n=re("span"),u=je(f),this.h()},l(m){e=ae(m,"LABEL",{for:!0,class:!0});var c=se(e);r=ae(c,"SPAN",{});var d=se(r);o=Me(d,a),d.forEach(B),i=he(c),n=ae(c,"SPAN",{class:!0});var h=se(n);u=Me(h,f),h.forEach(B),c.forEach(B),this.h()},h(){K(n,"class","text-accent"),K(e,"for",t[0]),K(e,"class",l=Ye("p-0",t[2]))},m(m,c){fe(m,e,c),H(e,r),H(r,o),H(e,i),H(e,n),H(n,u)},p(m,[c]){c&3&&a!==(a=(m[1]?m[1]:Je(m[0]))+"")&&Ne(o,a),c&8&&f!==(f=m[3]?"*":"")&&Ne(u,f),c&1&&K(e,"for",m[0]),c&4&&l!==(l=Ye("p-0",m[2]))&&K(e,"class",l)},i:Ge,o:Ge,d(m){m&&B(e)}}}function Tt(t,e,r){let a,{name:o}=e,{formObj:i}=e,{label:n=void 0}=e,{class:f=void 0}=e,u;const{form:l,errors:m,constraints:c}=i;return Fe(t,c,d=>r(6,a=d)),bt(async()=>{const d=await a[o];d!=null&&d.required&&r(3,u=d.required)}),t.$$set=d=>{"name"in d&&r(0,o=d.name),"formObj"in d&&r(5,i=d.formObj),"label"in d&&r(1,n=d.label),"class"in d&&r(2,f=d.class)},[o,n,f,u,c,i]}class yn extends tt{constructor(e){super(),nt(this,e,Tt,Ut,$e,{name:0,formObj:5,label:1,class:2})}}function ie(t){return t.toString().split(/[[\].]+/).filter(e=>e)}function Oe(t){return t.reduce((e,r)=>(typeof r=="number"||!isNaN(parseInt(String(r),10))?e+=`[${String(r)}]`:e?e+=`.${String(r)}`:e+=String(r),e),"")}class R extends Error{constructor(e){super(e),Object.setPrototypeOf(this,R.prototype)}}function pe(t,e,r){return t[e]=r,"skip"}function Ie(t,e){return e.value!==void 0&&typeof e.value!="object"&&e.path.length<t.length}function Dt(t,e,r={}){r.modifier||(r.modifier=o=>Ie(e,o)?void 0:o.value);const a=M(t,e,r.modifier);if(a)return r.value===void 0||r.value(a.value)?a:void 0}function M(t,e,r){if(!e.length)return;const a=[e[0]];let o=t;for(;a.length<e.length;){const n=a[a.length-1],f=r?r({parent:o,key:String(n),value:o[n],path:a.map(u=>String(u)),isLeaf:!1,set:u=>pe(o,n,u)}):o[n];if(f===void 0)return;o=f,a.push(e[a.length])}const i=e[e.length-1];return{parent:o,key:String(i),value:o[i],path:e.map(n=>String(n)),isLeaf:!0,set:n=>pe(o,i,n)}}function W(t,e,r=[]){for(const a in t){const o=t[a],i=o===null||typeof o!="object",n={parent:t,key:a,value:o,path:r.map(String).concat([a]),isLeaf:i,set:u=>pe(t,a,u)},f=e(n);if(f==="abort")return f;if(f==="skip")continue;if(!i){const u=W(o,e,n.path);if(u==="abort")return u}}}async function Zt(t,e,r=[]){for(const a in t){const o=t[a],i=o===null||typeof o!="object",n={parent:t,key:a,value:o,path:r.map(String).concat([a]),isLeaf:i,set:u=>pe(t,a,u)},f=await e(n);if(f==="abort")return f;if(f==="skip")break;if(!i){const u=W(o,e,n.path);if(u==="abort")return u}}}function qt(t,e){return t===e||t.size===e.size&&[...t].every(r=>e.has(r))}function Bt(t,e){const r=new Map;function a(o,i){const n=M(i,o.path);function f(){r.set(o.path.join(" "),o.path)}o.isLeaf?n?o.value!==n.value&&f():f():n&&(o.value instanceof Date&&n.value instanceof Date&&o.value.getTime()!=n.value.getTime()||o.value instanceof Set&&n.value instanceof Set&&!qt(o.value,n.value))&&f()}return W(t,o=>a(o,e)),W(e,o=>a(o,t)),Array.from(r.values())}function X(t,e,r){for(const a of e){const o=M(t,a,({parent:i,key:n,value:f})=>((f===void 0||typeof f!="object")&&(i[n]={}),i[n]));o&&(o.parent[o.key]=r)}}function bn(t,e,r){const a=ie(e),o=a.filter(f=>isNaN(parseInt(String(f)))).join("."),n={subscribe:Q(t.tainted,f=>{if(!f)return f;const u=M(f,a);return u?u.value:void 0}).subscribe,update(f){t.tainted.update(u=>{u||(u={});const l=M(u,a,m=>(m.value||(m.parent[m.key]={}),m.parent[m.key]));return l&&(l.parent[l.key]=f(l.value)),u})},set(f){t.tainted.update(u=>{u||(u={});const l=M(u,a,m=>(m.value||(m.parent[m.key]={}),m.parent[m.key]));return l&&(l.parent[l.key]=f),u})}};return{path:e,value:Wt(t,e,r),errors:ce(t.errors,e),constraints:ce(t.constraints,o),tainted:n}}function Wt(t,e,r){const a=t.form,o=ie(e),i=Q(a,n=>{const f=M(n,o);return f==null?void 0:f.value});return{subscribe(...n){const f=i.subscribe(...n);return()=>f()},update(n,f){a.update(u=>{const l=M(u,o);return l&&(l.parent[l.key]=n(l.value)),u},f??r)},set(n,f){a.update(u=>{const l=M(u,o);return l&&(l.parent[l.key]=n),u},f??r)}}}function ce(t,e){const r=ie(e),a=Q(t,o=>{const i=M(o,r);return i==null?void 0:i.value});return{subscribe(...o){const i=a.subscribe(...o);return()=>i()},update(o){t.update(i=>{const n=M(i,r);return n&&(n.parent[n.key]=o(n.value)),i})},set(o){t.update(i=>{const n=M(i,r);return n&&(n.parent[n.key]=o),i})}}}function Y(t){return"structuredClone"in globalThis?structuredClone(t):Pt(st(t))}function xt(t){const e=t;let r=!0,a=!1,o=!1,i=!1,n,f;for(;r;)t._def.typeName=="ZodNullable"?(a=!0,t=t.unwrap()):t._def.typeName=="ZodDefault"?(i=!0,f=t._def.defaultValue(),t=t._def.innerType):t._def.typeName=="ZodOptional"?(o=!0,t=t.unwrap()):t._def.typeName=="ZodEffects"?(n||(n=t),t=t._def.schema):t._def.typeName=="ZodPipeline"?t=t._def.out:r=!1;return{zodType:t,originalType:e,isNullable:a,isOptional:o,hasDefault:i,defaultValue:f,effects:n}}const Pe=new WeakMap;function Ve(t){return Pe.has(t)||Pe.set(t,ue(t)),Pe.get(t)}function ue(t){const e=xt(t).zodType;if(e._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(e.shape).map(([r,a])=>[r,ue(a)]).filter(r=>r[1]!==void 0));if(e._def.typeName=="ZodArray")return ue(e._def.type)??{};if(e._def.typeName=="ZodRecord")return ue(e._def.valueType)??{};if(e._def.typeName=="ZodUnion")return e._def.options.reduce((a,o)=>{const i=ue(o);return i&&(a={...a??{},...i}),a},void 0)}function ve(t,e,r=!0){const a={},o=Object.entries(t);if("_errors"in t&&t._errors.length){if(!e||!r)return t._errors;a._errors=t._errors}for(const[i,n]of o.filter(([f])=>f!=="_errors")){const f=!isNaN(parseInt(i,10));a[i]=ve(n,e?f?e:e[i]:void 0,!!(e!=null&&e[i]))}return a}function Ht(t){return ot(t,[])}function ot(t,e){return Object.entries(t).filter(([,a])=>a!==void 0).flatMap(([a,o])=>{if(Array.isArray(o)&&o.length>0){const i=e.concat([a]);return{path:Oe(i),messages:o}}else return ot(t[a],e.concat([a]))})}function Le(t,e){t.update(r=>(W(r,a=>{if(!(a.path.length==1&&a.path[0]=="_errors"&&!e.clearFormLevelErrors)&&Array.isArray(a.value))return a.set(void 0)}),e.undefinePath&&X(r,[e.undefinePath],void 0),r))}async function ut(t,e,r,a,o){return Gt(t.validators,e,r,a,o)}async function Gt(t,e,r,a,o){let i=!0,n={};if(t)if("safeParseAsync"in t){const f=t,u=await f.safeParseAsync(e);i=u.success,u.success?e=u.data:n=ve(u.error.format(),Ve(f))}else{e={...e};for(const[l,m]of Object.entries(t))typeof m=="function"&&!(l in e)&&(e[l]=void 0);const f=t,u=[];await Zt(e,async({value:l,path:m})=>{const c=m.filter(h=>isNaN(parseInt(h))),d=M(f,c);if(typeof(d==null?void 0:d.value)=="function"){const h=d.value;let _;if(Array.isArray(l))for(const y in l)try{_=await h(l[y]),_&&(i=!1,u.push({path:m.concat([y]),errors:typeof _=="string"?[_]:_??void 0}))}catch(N){i=!1,console.error(`Error in form validators for field "${m}":`,N)}else try{_=await h(l),_&&(i=!1,u.push({path:m,errors:typeof _=="string"?[_]:_??void 0}))}catch(y){i=!1,console.error(`Error in form validators for field "${m}":`,y)}}});for(const{path:l,errors:m}of u){const c=M(n,l,({parent:d,key:h,value:_})=>(_===void 0&&(d[h]={}),d[h]));if(c){const{parent:d,key:h}=c;d[h]=m}}}return{valid:i,posted:o,errors:n,data:e,constraints:a,message:void 0,id:r}}async function Jt(t,e,r,a){if(typeof t.validators!="object"||!("safeParseAsync"in t.validators))return;const o=t.validators,i=await o.safeParseAsync(e);if(i.success)r.update(n=>(W(n,f=>{if(f.key=="_errors")return f.set(void 0)}),n));else{const n=ve(i.error.format(),Ve(o));r.update(f=>(W(f,u=>{if(u.key=="_errors")return u.set(void 0)}),W(n,u=>{if(u.key=="_errors"){const l=u.path.length==1?{value:!0}:a&&M(a,u.path.slice(0,-1));if(l&&l.value)return X(f,[u.path],u.value)}}),f))}}async function Ce(t,e,r,a,o,i={}){function n(){Le(a,{undefinePath:t,clearFormLevelErrors:!0})}function f(l){return typeof l=="string"&&(l=[l]),(i.update===!0||i.update=="errors")&&a.update(m=>{const c=M(m,t,d=>{if(Ie(t,d))throw new R("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+d.path.slice(0,-1));return d.value===void 0?(d.parent[d.key]={},d.parent[d.key]):d.value});if(!c)throw new R("Error path could not be created: "+t);return c.parent[c.key]=l??void 0,m}),l??void 0}const u=await Yt(t,e.validators,r,a,o,i);if(u.validated)if(u.validated==="all"&&!u.errors)n();else return u.errors=f(u.errors),u;else if(u.validated===!1&&e.defaultValidator=="clear")return u.errors=f(u.errors),u;return u}async function Yt(t,e,r,a,o,i={}){i.update===void 0&&(i.update=!0),i.taint===void 0&&(i.taint=!1),typeof i.errors=="string"&&(i.errors=[i.errors]);const n={value:i.value,shouldUpdate:!0,currentData:void 0,validationPath:t.filter(d=>isNaN(parseInt(d)))};async function f(){return{validated:!1,errors:void 0,data:void 0}}function u(d,h){if(h===void 0)return!1;const _=M(h,d);return _?_.value:!1}function l(d){a.update(d)}function m(){Le(a,{undefinePath:null,clearFormLevelErrors:!0})}function c(d,h){return ve(d.format(),Ve(h))}if("value"in i)i.update===!0||i.update==="value"?r.update(d=>(X(d,[t],n.value),n.currentData=d),{taint:i.taint}):n.shouldUpdate=!1;else{n.currentData=S(r);const d=M(n.currentData,t);n.value=d==null?void 0:d.value}if(typeof e!="object")return f();if("safeParseAsync"in e){n.shouldUpdate||(n.currentData=Y(n.currentData??S(r)),X(n.currentData,[t],n.value));const d=await e.safeParseAsync(n.currentData);if(d.success)return m(),{validated:!0,errors:void 0,data:d.data};{const h=c(d.error,e);if(i.update===!0||i.update=="errors"){const y=S(o);l(N=>(W(N,k=>{if(k.key=="_errors")return k.set(void 0)}),W(h,k=>{if(k.key=="_errors"&&(k.path.length==1||u(k.path.slice(0,-1),y)))return X(N,[k.path],k.value);if(Array.isArray(k.value))return u(k.path,y)&&X(N,[k.path],k.value),"skip"}),N))}const _=M(h,t);return{validated:!0,errors:i.errors??(_==null?void 0:_.value),data:void 0}}}else{const d=M(e,n.validationPath);if(!d||d.value===void 0)return f();{const h=await d.value(n.value);return{validated:!0,errors:h&&(i.errors??h),data:void 0}}}}function ze(t){!t.flashMessage||!it||Re(t)&&(document.cookie=`flash=; Max-Age=0; Path=${t.flashMessage.cookiePath??"/"};`)}function Re(t){return!t.flashMessage||!it?!1:t.syncFlashMessage}const ft="noCustomValidity";function lt(t,e){const r=e&&e.length?e.join(`
`):"";t.setCustomValidity(r),r&&t.reportValidity()}function Kt(t,e){for(const r of t.querySelectorAll("input,select,textarea,button")){if(ft in r.dataset)continue;const a=M(e,ie(r.name));if(lt(r,a==null?void 0:a.value),a!=null&&a.value)return}}function Qt(t,e,r,a,o,i,n,f,u,l,m,c,d,h,_,y,N){l();const k=o;async function J(A,O,F){if(n.validationMethod=="submit-only")return;if(n.customValidity&&F){if("setCustomValidity"in F&&F.setCustomValidity(""),O=="input"&&n.validationMethod=="onblur")return;if(ft in F.dataset){if(O=="input")return;F=null}}const I=await Ce(A,n,f,k,h);F&&lt(F,I.errors)}function p(A){return A&&(A instanceof HTMLSelectElement||A instanceof HTMLInputElement&&(A.type=="radio"||A.type=="checkbox"))}async function E(A){if(!(n.validationMethod=="oninput"||n.validationMethod=="submit-only")){p(A.target)&&await new Promise(O=>setTimeout(O,0));for(const O of S(_)){let F=null;if(n.customValidity){const I=CSS.escape(Oe(O));F=t.querySelector(`[name="${I}"]`)}J(O,"blur",F)}_.set([])}}t.addEventListener("focusout",E);async function G(A){if(!(n.validationMethod=="onblur"||n.validationMethod=="submit-only")){p(A.target)&&await new Promise(O=>setTimeout(O,0));for(const O of S(_)){const F=CSS.escape(Oe(O)),I=t.querySelector(`[name="${F}"]`);if(!I)continue;const V=M(S(k),O);V&&V.key in V.parent&&setTimeout(()=>J(O,"input",I),0)}}}n.customValidity&&t.addEventListener("input",G),et(()=>{t.removeEventListener("focusout",E),t.removeEventListener("input",G)});const T=vt(t,{submitting:e,delayed:r,timeout:a},n);let z;return At(t,async A=>{var de,oe;const O=A.cancel;let F=!1;function I(){return F=!0,O()}if(A.cancel=I,T.isSubmitting()&&n.multipleSubmits=="prevent")I();else{T.isSubmitting()&&n.multipleSubmits=="abort"&&z&&z.abort(),z=A.controller;for(const U of m.onSubmit)await U(A)}if(F)n.flashMessage&&ze(n);else{const U=await ut(n,S(f),S(c),S(d),S(N));if(!U.valid){I();const g={type:"failure",status:(typeof n.SPA=="boolean"||(de=n.SPA)==null?void 0:de.failStatus)??400,data:{form:U}};setTimeout(()=>L({result:g}),0)}if(!F){switch(n.clearOnSubmit){case"errors-and-message":k.clear(),u.set(void 0);break;case"errors":k.clear();break;case"message":u.set(void 0);break}n.flashMessage&&(n.clearOnSubmit=="errors-and-message"||n.clearOnSubmit=="message")&&Re(n)&&n.flashMessage.module.getFlash(le).set(void 0),T.submitting();const g="formData"in A?A.formData:A.data;if(n.SPA){I();const P={...U,posted:!0},D={type:P.valid?"success":"failure",status:P.valid?200:typeof n.SPA=="object"?(oe=n.SPA)==null?void 0:oe.failStatus:400,data:{form:P}};setTimeout(()=>L({result:D}),0)}else if(n.dataType==="json"){const P=U.data,D=V(st(P),n.jsonChunkSize??5e5);for(const C of D)g.append("__superform_json",C);Object.keys(P).forEach(C=>{typeof g.get(C)=="string"&&g.delete(C)})}if(!n.SPA&&!g.has("__superform_id")){const P=S(c);P!==void 0&&g.set("__superform_id",P)}}}function V(U,g){const P=Math.ceil(U.length/g),D=new Array(P);for(let C=0,Z=0;C<P;++C,Z+=g)D[C]=U.substring(Z,Z+g);return D}async function L(U){const g=U.result;z=null;let P=!1;const D={result:g,formEl:t,cancel:()=>P=!0};for(const C of m.onResult)await C(D);if(!P){if((g.type==="success"||g.type=="failure")&&g.data){const C=y(g.data);if(!C.length)throw new R("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const Z of C){if(Z.id!==S(c))continue;const me={form:Z,formEl:t,cancel:()=>P=!0};for(const $ of m.onUpdate)await $(me);!P&&n.customValidity&&Kt(t,me.form.errors)}}if(!P){if(g.type!=="error")g.type==="success"&&n.invalidateAll&&await _t(),n.applyAction?await Se(g):await i(g);else{if(n.applyAction)if(n.onError=="apply")await Se(g);else{const C={type:"failure",status:Math.floor(g.status||500),data:g};await Se(C)}if(n.onError!=="apply"){const C={result:g,message:u};for(const Z of m.onError)Z!=="apply"&&await Z(C)}}n.flashMessage&&g.type=="error"&&n.flashMessage.onError&&await n.flashMessage.onError({result:g,message:n.flashMessage.module.getFlash(le)})}}P&&n.flashMessage&&ze(n),P||g.type!="redirect"?T.completed(P):g.type=="redirect"&&new URL(g.location,/^https?:\/\//.test(g.location)?void 0:document.location.origin).pathname==document.location.pathname&&setTimeout(()=>{T.completed(!0,!0)},0)}return L})}const Xt={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:t=>{console.warn("Unhandled Superform error, use onError event to handle it:",t.result.error)},dataType:"form",validators:void 0,defaultValidator:"keep",customValidity:!1,clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0,SPA:void 0,validateMethod:"auto"},ye=new WeakMap,te=new WeakMap;function zt(t){return`Duplicate form id's found: "${t}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}function hn(t,e={}){var Ue,Te;e={...Xt,...e},e.SPA&&e.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add them to the validators option, or set it to false to disable this warning.");let r=e.id;!t||h(t)===!1?(((Ue=e.warnings)==null?void 0:Ue.noValidationAndConstraints)!==!1&&console.warn((t?"Form data sent directly to superForm instead of through superValidate. No initial data validation is made. ":"No form data sent to superForm, schema type safety cannot be guaranteed. ")+"Also, no constraints will exist for the form. Set the warnings.noValidationAndConstraints option to false to disable this warning."),t={valid:!1,posted:!1,errors:{},data:t??{},constraints:{}}):r===void 0&&(r=t.id);const a=r,o=S(le);if(((Te=e.warnings)==null?void 0:Te.duplicateId)!==!1)if(!ye.has(o))ye.set(o,new Set([a]));else{const s=ye.get(o);s!=null&&s.has(a)?console.warn(zt(a)):s==null||s.add(a)}te.has(t)||te.set(t,Y(t));const i=te.get(t);if(typeof i.valid!="boolean")throw new R("A non-validation object was passed to superForm. It should be an object of type SuperValidated, usually returned from superValidate.");o.form,t=Y(i);const n=t,f=q(n.errors),u=q(r),l={taintedMessage:e.taintedMessage,taintedFormState:Y(i.data)};function m(s=8){return Math.random().toString(36).substring(2,s+2)}function c(s){l.taintedFormState=Y(s)}function d(s){return Object.values(s).filter(v=>h(v)!==!1)}function h(s){return!s||typeof s!="object"||!("valid"in s&&"errors"in s&&typeof s.valid=="boolean")?!1:"id"in s&&typeof s.id=="string"?s.id:void 0}function _(){e.taintedMessage=l.taintedMessage,r===void 0&&u.set(m())}function y(s){const b=q(s);return{subscribe:b.subscribe,set:(v,w={})=>(g(v,l.taintedFormState,w.taint??!0),c(v),b.set(Y(v))),update:(v,w={})=>b.update(j=>{const ee=v(j);return g(ee,l.taintedFormState,w.taint??!0),c(ee),ee})}}const N=[u.subscribe(s=>r=s)];function k(s){N.push(s)}function J(){N.forEach(s=>s())}const p=y(n.data);function E(s,b){if(!(!b||typeof b!="object")){if(Array.isArray(b))b.length>0&&E(s,b[0]);else if(!(b instanceof Date))throw new R(`Object found in form field "${s}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}}async function G(s,b){s.valid&&b&&e.resetForm&&(e.resetForm===!0||e.resetForm())?T(s.message):$(s,b),x.onUpdated.length&&await ht();for(const v of x.onUpdated)v({form:s})}function T(s,b,v){const w=Y(i);w.data={...w.data,...b},v!==void 0&&(w.id=v),$(w,!0,s)}const z=async(s,b)=>{if(s.type=="error")throw new R(`ActionResult of type "${s.type}" cannot be passed to update function.`);if(s.type=="redirect"){e.resetForm&&(e.resetForm===!0||e.resetForm())&&T();return}if(typeof s.data!="object")throw new R("Non-object validation data returned from ActionResult.");const v=d(s.data);if(!v.length)throw new R("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const w of v)w.id===r&&await G(w,b??(s.status>=200&&s.status<300))},A=q([]),O=q(n.message),F=q(n.constraints),I=q(!1),V={subscribe:f.subscribe,set:f.set,update:f.update,clear:()=>Le(f,{undefinePath:null,clearFormLevelErrors:!0})},L=q();function de(){return S(L)}function oe(s){if(s===null)throw new R("$tainted store contained null");if(typeof s=="object"){for(const b of Object.values(s))if(oe(b))return!0}return s===!0}async function U(s,b){let v=e.validationMethod==="oninput";if(!v){const w=S(V),j=w?Dt(w,s,{modifier:_e=>{if(Ie(s,_e))throw new R("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+_e.path.slice(0,-1));return _e.value}}):void 0;v=!!(j&&j.key in j.parent)}return v?(await Ce(s,e,p,V,L,{taint:b}),!0):!1}async function g(s,b,v){if(v===!1)return;if(v==="untaint-all"){L.set(void 0);return}let w=Bt(s,b);if(typeof v=="object"&&(typeof v.fields=="string"&&(v.fields=[v.fields]),w=v.fields.map(j=>ie(j)),v=!0),v===!0&&A.set(w),w.length&&(L.update(j=>(j||(j={}),X(j,w,v===!0?!0:void 0),j)),!(e.validationMethod=="onblur"||e.validationMethod=="submit-only"))){let j=!1;for(const ee of w)j=j||await U(ee,v);j||await Jt(e,S(p),V,S(L))}}function P(s,b){L.set(s),c(b)}const D=q(!1),C=q(!1),Z=q(!1),me=Q(V,s=>s?Ht(s):[]);if(e.taintedMessage=void 0,et(()=>{var s;J();for(const b of Object.values(x))b.length=0;(s=ye.get(o))==null||s.delete(a)}),e.dataType!=="json")for(const[s,b]of Object.entries(n.data))E(s,b);function $(s,b,v){if(b&&P(typeof b=="boolean"?void 0:b,s.data),v=v??s.message,p.set(s.data,{taint:!1}),O.set(v),V.set(s.errors),u.set(s.id),I.set(s.posted),e.flashMessage&&Re(e)){const w=e.flashMessage.module.getFlash(le);v&&S(w)===void 0&&w.set(v)}}const x={onSubmit:e.onSubmit?[e.onSubmit]:[],onResult:e.onResult?[e.onResult]:[],onUpdate:e.onUpdate?[e.onUpdate]:[],onUpdated:e.onUpdated?[e.onUpdated]:[],onError:e.onError?[e.onError]:[]};gt(s=>{if(e.taintedMessage&&!S(D)){const b=de();b&&oe(b)&&!window.confirm(e.taintedMessage)&&s.cancel()}}),k(le.subscribe(async s=>{if(!e.applyAction)return;e.SPA&&await new Promise(v=>setTimeout(v,0));const b=s.status>=200&&s.status<300;if(s.form&&typeof s.form=="object"){const v=s.form;if(v.type=="error")return;const w=d(v);for(const j of w)j.id!==r||te.has(j)||(te.set(j,j),await G(j,b))}else if(s.data&&typeof s.data=="object"){const v=d(s.data);for(const w of v)w.id!==r||te.has(w)||$(w,b)}}));const ct=Object.fromEntries(Object.keys(i.data).map(s=>[s,{name:s,value:ce(p,s),errors:ce(V,s),constraints:ce(F,s)}]));async function dt(s,b){return s===void 0?ut(e,S(p),r,S(F),!1):(await Ce(ie(s),e,p,V,L,b)).errors}return{form:p,formId:u,errors:V,message:O,constraints:F,fields:ct,tainted:L,submitting:Q(D,s=>s),delayed:Q(C,s=>s),timeout:Q(Z,s=>s),options:e,capture:function(){return{valid:i.valid,posted:S(I),errors:S(V),data:S(p),constraints:S(F),message:S(O),id:r,tainted:S(L)}},restore:function(s){return $(s,s.tainted??!0)},validate:dt,enhance:(s,b)=>{if(b){if(b.onError){if(e.onError==="apply")throw new R('options.onError is set to "apply", cannot add any onError events.');if(b.onError==="apply")throw new R('Cannot add "apply" as onError event in use:enhance.');x.onError.push(b.onError)}b.onResult&&x.onResult.push(b.onResult),b.onSubmit&&x.onSubmit.push(b.onSubmit),b.onUpdate&&x.onUpdate.push(b.onUpdate),b.onUpdated&&x.onUpdated.push(b.onUpdated)}return Qt(s,D,C,Z,V,z,e,p,O,_,x,u,F,L,A,d,I)},allErrors:me,posted:I,reset:s=>T(s!=null&&s.keepMessage?S(O):void 0,s==null?void 0:s.data,s==null?void 0:s.id)}}export{mn as F,yn as L,It as d,bn as f,hn as s};
