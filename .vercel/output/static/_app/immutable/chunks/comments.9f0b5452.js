import{s as ae,e as g,a as S,t as W,H as Ue,c as I,b as C,f as d,g as O,d as X,z as Fe,o as m,r as se,i as P,h as u,j as re,k as Te,m as ie,p as Ne,n as oe,a4 as je,D as _e,w as De,l as ve,u as Ae}from"./scheduler.60fdcb34.js";import{S as ue,i as me,c as Y,a as Z,m as $,t as q,g as ye,b as G,e as Ve,d as x}from"./index.c7b4b125.js";import{e as ne}from"./each.e5af29b3.js";import{e as Se}from"./forms.eea97056.js";import{p as Oe}from"./stores.b0332cd2.js";import{L as Be}from"./like-count.ca442c40.js";import{f as pe}from"./formatters.8e53af36.js";import{I as Pe}from"./Icon.8be3835b.js";import{F as Le,s as Me}from"./index.92f1b852.js";import{I as qe}from"./input.b0365756.js";import{f as He}from"./client.3119d533.js";function be(s){let e,l,t,n,a,r,_,i,v,b,E,V,w,h,f="Delete",p,N,H;return t=new Pe({props:{icon:"mdi:dots-vertical"}}),{c(){e=g("div"),l=g("label"),Y(t.$$.fragment),n=S(),a=g("div"),r=g("a"),_=W("Edit"),v=S(),b=g("form"),E=g("input"),w=S(),h=g("button"),h.textContent=f,this.h()},l(F){e=I(F,"DIV",{class:!0});var j=C(e);l=I(j,"LABEL",{tabindex:!0});var L=C(l);Z(t.$$.fragment,L),L.forEach(d),n=O(j),a=I(j,"DIV",{tabindex:!0,class:!0});var y=C(a);r=I(y,"A",{href:!0,class:!0});var M=C(r);_=X(M,"Edit"),M.forEach(d),v=O(y),b=I(y,"FORM",{method:!0,action:!0});var k=C(b);E=I(k,"INPUT",{type:!0,name:!0}),w=O(k),h=I(k,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ie(h)!=="svelte-ehj3td"&&(h.textContent=f),k.forEach(d),y.forEach(d),j.forEach(d),this.h()},h(){m(l,"tabindex","-1"),m(r,"href",i=s[2].url.pathname+"?editComment="+s[0].id),m(r,"class","btn btn-xs"),m(E,"type","hidden"),m(E,"name","id"),E.value=V=s[0].id,m(h,"class","btn btn-xs w-full text-error"),m(b,"method","post"),m(b,"action","/api/comment/?/delete"),m(a,"tabindex","-1"),m(a,"class","dropdown-content menu shadow-lg bg-base-200 rounded-box w-24"),m(e,"class","dropdown dropdown-top dropdown-end pb-1")},m(F,j){P(F,e,j),u(e,l),$(t,l,null),u(e,n),u(e,a),u(a,r),u(r,_),u(a,v),u(a,b),u(b,E),u(b,w),u(b,h),p=!0,N||(H=Ne(Se.call(null,b)),N=!0)},p(F,j){(!p||j&5&&i!==(i=F[2].url.pathname+"?editComment="+F[0].id))&&m(r,"href",i),(!p||j&1&&V!==(V=F[0].id))&&(E.value=V)},i(F){p||(q(t.$$.fragment,F),p=!0)},o(F){G(t.$$.fragment,F),p=!1},d(F){F&&d(e),x(t),N=!1,H()}}}function Re(s){var B,T,Q,ee;let e,l,t,n,a,r,_,i,v,b,E,V=`@${s[0].User.username}`,w,h,f,p,N,H=s[0].comment+"",F,j,L=pe(((B=s[0])==null?void 0:B.createdAt)??new Date)+"",y,M,k,K,U,c,o=(s[1].userId===((T=s[0].User)==null?void 0:T.id)||((Q=s[1])==null?void 0:Q.userId)===s[0].publisherId)&&be(s);return U=new Be({props:{userId:(ee=s[1])==null?void 0:ee.userId,type:"comment",item:s[0]}}),{c(){e=g("div"),l=g("div"),t=g("div"),n=g("img"),_=S(),i=g("div"),v=g("div"),b=g("div"),E=g("a"),w=W(V),f=S(),p=g("div"),N=new Ue(!1),F=S(),j=g("div"),y=W(L),M=S(),o&&o.c(),k=S(),K=g("div"),Y(U.$$.fragment),this.h()},l(D){e=I(D,"DIV",{class:!0});var A=C(e);l=I(A,"DIV",{class:!0});var R=C(l);t=I(R,"DIV",{class:!0});var te=C(t);n=I(te,"IMG",{alt:!0,src:!0}),te.forEach(d),R.forEach(d),_=O(A),i=I(A,"DIV",{class:!0});var z=C(i);v=I(z,"DIV",{class:!0});var J=C(v);b=I(J,"DIV",{class:!0});var le=C(b);E=I(le,"A",{href:!0});var fe=C(E);w=X(fe,V),fe.forEach(d),le.forEach(d),f=O(J),p=I(J,"DIV",{});var ce=C(p);N=Fe(ce,!1),ce.forEach(d),F=O(J),j=I(J,"DIV",{class:!0});var de=C(j);y=X(de,L),de.forEach(d),J.forEach(d),M=O(z),o&&o.l(z),k=O(z),K=I(z,"DIV",{class:!0});var he=C(K);Z(U.$$.fragment,he),he.forEach(d),z.forEach(d),A.forEach(d),this.h()},h(){m(n,"alt",a=s[0].User.username),se(n.src,r=s[0].User.avatar)||m(n,"src",r),m(t,"class","w-8 h-8 rounded-full"),m(l,"class","avatar pt-1"),m(E,"href",h="/user/"+s[0].User.id),m(b,"class","font-bold pb-2"),N.a=null,m(j,"class","text-xs text-accent"),m(v,"class","w-full"),m(K,"class","flex flex-col gap-4 justify-between relative"),m(i,"class","flex gap-2 py-2 items-end w-full justify-between pr-4"),m(e,"class","flex items-start gap-2")},m(D,A){P(D,e,A),u(e,l),u(l,t),u(t,n),u(e,_),u(e,i),u(i,v),u(v,b),u(b,E),u(E,w),u(v,f),u(v,p),N.m(H,p),u(v,F),u(v,j),u(j,y),u(i,M),o&&o.m(i,null),u(i,k),u(i,K),$(U,K,null),c=!0},p(D,[A]){var te,z,J,le;(!c||A&1&&a!==(a=D[0].User.username))&&m(n,"alt",a),(!c||A&1&&!se(n.src,r=D[0].User.avatar))&&m(n,"src",r),(!c||A&1)&&V!==(V=`@${D[0].User.username}`)&&re(w,V),(!c||A&1&&h!==(h="/user/"+D[0].User.id))&&m(E,"href",h),(!c||A&1)&&H!==(H=D[0].comment+"")&&N.p(H),(!c||A&1)&&L!==(L=pe(((te=D[0])==null?void 0:te.createdAt)??new Date)+"")&&re(y,L),D[1].userId===((z=D[0].User)==null?void 0:z.id)||((J=D[1])==null?void 0:J.userId)===D[0].publisherId?o?(o.p(D,A),A&3&&q(o,1)):(o=be(D),o.c(),q(o,1),o.m(i,k)):o&&(ye(),G(o,1,1,()=>{o=null}),Ve());const R={};A&2&&(R.userId=(le=D[1])==null?void 0:le.userId),A&1&&(R.item=D[0]),U.$set(R)},i(D){c||(q(o),q(U.$$.fragment,D),c=!0)},o(D){G(o),G(U.$$.fragment,D),c=!1},d(D){D&&d(e),o&&o.d(),x(U)}}}function Ge(s,e,l){let t;Te(s,Oe,r=>l(2,t=r));let{item:n}=e,{user:a}=e;return s.$$set=r=>{"item"in r&&l(0,n=r.item),"user"in r&&l(1,a=r.user)},[n,a,t]}class ze extends ue{constructor(e){super(),me(this,e,Ge,Re,ae,{item:0,user:1})}}function Je(s){let e,l="post";return{c(){e=g("button"),e.textContent=l,this.h()},l(t){e=I(t,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ie(e)!=="svelte-1pxqro9"&&(e.textContent=l),this.h()},h(){m(e,"class","join-item btn btn-primary w-24 mt-1")},m(t,n){P(t,e,n)},p:oe,d(t){t&&d(e)}}}function Ke(s){let e,l;return{c(){e=g("button"),l=g("span"),this.h()},l(t){e=I(t,"BUTTON",{class:!0});var n=C(e);l=I(n,"SPAN",{class:!0}),C(l).forEach(d),n.forEach(d),this.h()},h(){m(l,"class","loading loading-dots loading-md"),m(e,"class","join-item btn btn-primary w-24 mt-1"),e.disabled=s[5]},m(t,n){P(t,e,n),u(e,l)},p(t,n){n&32&&(e.disabled=t[5])},d(t){t&&d(e)}}}function Qe(s){let e,l,t,n,a,r,_,i,v,b,E;v=new qe({props:{formObj:s[6],name:"comment",label:" ",placeholder:"add a comment",class:"rounded-r-none shadow-lg"}});function V(f,p){return f[5]?Ke:Je}let w=V(s),h=w(s);return{c(){e=g("input"),l=S(),t=g("input"),n=S(),a=g("input"),_=S(),i=g("div"),Y(v.$$.fragment),b=S(),h.c(),this.h()},l(f){e=I(f,"INPUT",{type:!0,name:!0}),l=O(f),t=I(f,"INPUT",{type:!0,name:!0}),n=O(f),a=I(f,"INPUT",{type:!0,name:!0}),_=O(f),i=I(f,"DIV",{class:!0});var p=C(i);Z(v.$$.fragment,p),b=O(p),h.l(p),p.forEach(d),this.h()},h(){var f;m(e,"type","hidden"),m(e,"name","itemId"),e.value=s[0],m(t,"type","hidden"),m(t,"name","type"),t.value=s[1],m(a,"type","hidden"),m(a,"name","userId"),a.value=r=(f=s[3])==null?void 0:f.userId,m(i,"class","join w-full")},m(f,p){P(f,e,p),P(f,l,p),P(f,t,p),P(f,n,p),P(f,a,p),P(f,_,p),P(f,i,p),$(v,i,null),u(i,b),h.m(i,null),E=!0},p(f,p){var N;(!E||p&1)&&(e.value=f[0]),(!E||p&2)&&(t.value=f[1]),(!E||p&8&&r!==(r=(N=f[3])==null?void 0:N.userId))&&(a.value=r),w===(w=V(f))&&h?h.p(f,p):(h.d(1),h=w(f),h&&(h.c(),h.m(i,null)))},i(f){E||(q(v.$$.fragment,f),E=!0)},o(f){G(v.$$.fragment,f),E=!1},d(f){f&&(d(e),d(l),d(t),d(n),d(a),d(_),d(i)),x(v),h.d()}}}function We(s){let e,l;return e=new Le({props:{action:s[2],formObj:s[6],$$slots:{default:[Qe]},$$scope:{ctx:s}}}),{c(){Y(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,n){$(e,t,n),l=!0},p(t,[n]){const a={};n&4&&(a.action=t[2]),n&555&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){G(e.$$.fragment,t),l=!1},d(t){x(e,t)}}}function Xe(s,e,l){let t,n,a=oe,r=()=>(a(),a=je(t,w=>l(5,n=w)),t);s.$$.on_destroy.push(()=>a());let{commentForm:_}=e,{itemId:i}=e,{type:v}=e,{action:b}=e,{user:E}=e;const V=Me(_,{onSubmit(){},onResult(){},flashMessage:{module:He,onError:({result:w,message:h})=>{h.set({type:"error",message:w.error.message})}}});return s.$$set=w=>{"commentForm"in w&&l(7,_=w.commentForm),"itemId"in w&&l(0,i=w.itemId),"type"in w&&l(1,v=w.type),"action"in w&&l(2,b=w.action),"user"in w&&l(3,E=w.user)},r(l(4,{delayed:t}=V,t)),[i,v,b,E,t,n,V,_]}class Ye extends ue{constructor(e){super(),me(this,e,Xe,We,ae,{commentForm:7,itemId:0,type:1,action:2,user:3})}}function ge(s,e,l){const t=s.slice();return t[11]=e[l],t}function Ie(s,e,l){const t=s.slice();return t[14]=e[l],t}function we(s){let e,l=ne(s[7]()),t=[];for(let n=0;n<l.length;n+=1)t[n]=Ee(Ie(s,l,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=ve()},l(n){for(let a=0;a<t.length;a+=1)t[a].l(n);e=ve()},m(n,a){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(n,a);P(n,e,a)},p(n,a){if(a&128){l=ne(n[7]());let r;for(r=0;r<l.length;r+=1){const _=Ie(n,l,r);t[r]?t[r].p(_,a):(t[r]=Ee(_),t[r].c(),t[r].m(e.parentNode,e))}for(;r<t.length;r+=1)t[r].d(1);t.length=l.length}},d(n){n&&d(e),De(t,n)}}}function Ee(s){let e,l,t,n,a;return{c(){e=g("div"),l=g("div"),t=g("img"),a=S(),this.h()},l(r){e=I(r,"DIV",{class:!0});var _=C(e);l=I(_,"DIV",{class:!0});var i=C(l);t=I(i,"IMG",{alt:!0,src:!0}),i.forEach(d),a=O(_),_.forEach(d),this.h()},h(){m(t,"alt",""),se(t.src,n=s[14])||m(t,"src",n),m(l,"class","w-6 bg-base-300"),m(e,"class","avatar")},m(r,_){P(r,e,_),u(e,l),u(l,t),u(e,a)},p:oe,d(r){r&&d(e)}}}function ke(s){let e,l;return e=new ze({props:{user:s[2],item:s[11]}}),{c(){Y(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,n){$(e,t,n),l=!0},p(t,n){const a={};n&4&&(a.user=t[2]),n&64&&(a.item=t[11]),e.$set(a)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){G(e.$$.fragment,t),l=!1},d(t){x(e,t)}}}function Ce(s){let e,l,t,n;function a(i,v){return i[5]?$e:Ze}let r=a(s),_=r(s);return{c(){e=g("div"),l=g("button"),_.c(),this.h()},l(i){e=I(i,"DIV",{class:!0});var v=C(e);l=I(v,"BUTTON",{class:!0});var b=C(l);_.l(b),b.forEach(d),v.forEach(d),this.h()},h(){m(l,"class","btn btn-outline btn-sm w-full"),l.disabled=s[5],m(e,"class","py-4")},m(i,v){P(i,e,v),u(e,l),_.m(l,null),t||(n=Ae(l,"click",s[10]),t=!0)},p(i,v){r!==(r=a(i))&&(_.d(1),_=r(i),_&&(_.c(),_.m(l,null))),v&32&&(l.disabled=i[5])},d(i){i&&d(e),_.d(),t=!1,n()}}}function Ze(s){let e;return{c(){e=W("See more")},l(l){e=X(l,"See more")},m(l,t){P(l,e,t)},d(l){l&&d(e)}}}function $e(s){let e;return{c(){e=g("span"),this.h()},l(l){e=I(l,"SPAN",{class:!0}),C(e).forEach(d),this.h()},h(){m(e,"class","loading loading-dots loading-md")},m(l,t){P(l,e,t)},d(l){l&&d(e)}}}function xe(s){let e,l,t,n="Comments:",a,r,_,i,v,b,E,V=s[1]._count.Comments+"",w,h,f,p,N,H,F,j,L,y=s[0]&&we(s);N=new Ye({props:{action:"/api/comment/?/comment",commentForm:s[3],type:s[4],user:s[2],itemId:s[1].id??""}});let M=ne(s[6]),k=[];for(let c=0;c<M.length;c+=1)k[c]=ke(ge(s,M,c));const K=c=>G(k[c],1,1,()=>{k[c]=null});let U=s[1]._count.Comments>4&&Ce(s);return{c(){e=g("div"),l=g("div"),t=g("div"),t.textContent=n,a=S(),r=g("div"),y&&y.c(),_=S(),i=g("div"),v=g("div"),b=g("span"),E=W("+"),w=W(V),h=S(),f=g("hr"),p=S(),Y(N.$$.fragment),H=S(),F=g("div");for(let c=0;c<k.length;c+=1)k[c].c();j=S(),U&&U.c(),this.h()},l(c){e=I(c,"DIV",{class:!0});var o=C(e);l=I(o,"DIV",{class:!0});var B=C(l);t=I(B,"DIV",{class:!0,["data-svelte-h"]:!0}),ie(t)!=="svelte-148kom4"&&(t.textContent=n),a=O(B),r=I(B,"DIV",{class:!0});var T=C(r);y&&y.l(T),_=O(T),i=I(T,"DIV",{class:!0});var Q=C(i);v=I(Q,"DIV",{class:!0});var ee=C(v);b=I(ee,"SPAN",{});var D=C(b);E=X(D,"+"),w=X(D,V),D.forEach(d),ee.forEach(d),Q.forEach(d),T.forEach(d),B.forEach(d),h=O(o),f=I(o,"HR",{}),p=O(o),Z(N.$$.fragment,o),H=O(o),F=I(o,"DIV",{});var A=C(F);for(let R=0;R<k.length;R+=1)k[R].l(A);A.forEach(d),j=O(o),U&&U.l(o),o.forEach(d),this.h()},h(){m(t,"class","font-semibold"),_e(b,"text-xs",s[1]._count.Comments>=10),m(v,"class","w-6 bg-neutral-focus text-neutral-content"),m(i,"class","avatar placeholder"),m(r,"class","avatar-group -space-x-4"),m(l,"class","flex gap-2 justify-between items-end"),m(e,"class","mt-4")},m(c,o){P(c,e,o),u(e,l),u(l,t),u(l,a),u(l,r),y&&y.m(r,null),u(r,_),u(r,i),u(i,v),u(v,b),u(b,E),u(b,w),u(e,h),u(e,f),u(e,p),$(N,e,null),u(e,H),u(e,F);for(let B=0;B<k.length;B+=1)k[B]&&k[B].m(F,null);u(e,j),U&&U.m(e,null),L=!0},p(c,[o]){c[0]?y?y.p(c,o):(y=we(c),y.c(),y.m(r,_)):y&&(y.d(1),y=null),(!L||o&2)&&V!==(V=c[1]._count.Comments+"")&&re(w,V),(!L||o&2)&&_e(b,"text-xs",c[1]._count.Comments>=10);const B={};if(o&8&&(B.commentForm=c[3]),o&16&&(B.type=c[4]),o&4&&(B.user=c[2]),o&2&&(B.itemId=c[1].id??""),N.$set(B),o&68){M=ne(c[6]);let T;for(T=0;T<M.length;T+=1){const Q=ge(c,M,T);k[T]?(k[T].p(Q,o),q(k[T],1)):(k[T]=ke(Q),k[T].c(),q(k[T],1),k[T].m(F,null))}for(ye(),T=M.length;T<k.length;T+=1)K(T);Ve()}c[1]._count.Comments>4?U?U.p(c,o):(U=Ce(c),U.c(),U.m(e,null)):U&&(U.d(1),U=null)},i(c){if(!L){q(N.$$.fragment,c);for(let o=0;o<M.length;o+=1)q(k[o]);L=!0}},o(c){G(N.$$.fragment,c),k=k.filter(Boolean);for(let o=0;o<k.length;o+=1)G(k[o]);L=!1},d(c){c&&d(e),y&&y.d(),x(N),De(k,c),U&&U.d()}}}function et(s,e,l){let t,{comments:n}=e,{item:a}=e,{user:r}=e,{commentForm:_}=e,{type:i}=e;function v(){const h=n==null?void 0:n.map(f=>{var p;return(p=f.User)==null?void 0:p.avatar});return new Set(h)}let b=!1,E=[];async function V(){var p;l(5,b=!0);const h=(p=t.at(-1))==null?void 0:p.id,f=await fetch(`/api/newComment?take=4&cursor=${h}&whereType=eventId&whereId=${a.id}`);l(9,E=await f.json()),l(5,b=!1)}const w=()=>{V()};return s.$$set=h=>{"comments"in h&&l(0,n=h.comments),"item"in h&&l(1,a=h.item),"user"in h&&l(2,r=h.user),"commentForm"in h&&l(3,_=h.commentForm),"type"in h&&l(4,i=h.type)},s.$$.update=()=>{s.$$.dirty&513&&l(6,t=[...n,...E])},[n,a,r,_,i,b,t,v,V,E,w]}class ct extends ue{constructor(e){super(),me(this,e,et,xe,ae,{comments:0,item:1,user:2,commentForm:3,type:4})}}export{ct as C};
