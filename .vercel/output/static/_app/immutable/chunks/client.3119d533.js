import{w as F}from"./singletons.f8a34b6d.js";import{P as p,Q as h,R as A}from"./scheduler.60fdcb34.js";import{B as m}from"./prod-browser.020bfb54.js";import{a as w}from"./navigation.82bf316a.js";const s=new WeakMap;function M(t,e){return g(t,e)}function g(t,e){if(s.has(t))return s.get(t).store;e={clearArray:!1,clearOnNavigate:!0,...e};const r=F(),a={store:r,options:e};s.set(t,a),y(a,p(t).data.flash);let o=null;const b=t.subscribe(async n=>{await h(),setTimeout(async()=>{await c(t)?o="page":o=null})});let u,i;return e.clearAfterMs&&m&&(u=r.subscribe(n=>{n&&(i&&clearTimeout(i),i=setTimeout(()=>r.set(void 0),e==null?void 0:e.clearAfterMs))})),A(()=>{u&&(i&&clearTimeout(i),u()),b(),s.delete(t)}),w(async n=>{var f,d;n.type!="enter"&&(e!=null&&e.clearOnNavigate)&&((f=n.from)==null?void 0:f.url.toString())!=((d=n.to)==null?void 0:d.url.toString())&&r.set(void 0),o!="page"&&["form","goto"].includes(n.type)&&c(t)}),r}function _(t,e){const r=s.get(t);if(!r)return g(t,e);if(e)throw new Error("getFlash options can only be set at the first call to getFlash. Set the options at the highest level component that calls getFlash.");return r.store}async function c(t,e){const r=s.get(t);if(!r)throw new Error("Flash store must be initialized with getFlash(page) before calling updateFlash.");e&&await e(),await h();const a=O();return y(r,a),!!a}const C=t=>{const e={};return t?t.split(";").map(r=>r.split("=")).reduce((r,a)=>(r[decodeURIComponent(a[0].trim())]=decodeURIComponent(a[1].trim()),r),e):e},N="/",l="flash";function O(t){if(!t&&m&&(t=document.cookie),!t||!t.includes(l+"="))return;const e=C(t);if(e[l])try{return JSON.parse(e[l])}catch{}}function y(t,e){document.cookie=l+`=; Max-Age=0; Path=${N};`,e!==void 0&&t.store.update(r=>!t.options.clearArray&&Array.isArray(e)&&Array.isArray(r)?r.length>0&&e.length>0&&r[r.length-1]===e[e.length-1]?r:r.concat(e):e)}const P=Object.freeze(Object.defineProperty({__proto__:null,getFlash:_,initFlash:M,updateFlash:c},Symbol.toStringTag,{value:"Module"}));export{P as f,_ as g};
